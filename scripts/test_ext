#!/bin/bash
# 
# Test translation and send a message if necessary.
#
# Usage: ./test_ext somebody@somewhere

if [ -z "$1" ]; then
    echo "No e-mail address specified."
    exit 1
fi

PORT=8888
TIMEOUT=15

for LANG in de fr cs; do
    echo -n $LANG "-> en "
    ( curl -m $TIMEOUT -i -H "Content-Type: application/json" -X POST -d '{ "action":"translate", "sourceLang":"'$LANG'", "targetLang":"en", "text": "Test" }' http://quest.ms.mff.cuni.cz:$PORT/khresmoi > /dev/null 2>&1 && echo 'OK' ) || echo 'NOT WORKING'
    echo -n "en ->" $LANG "" 
    ( curl -m $TIMEOUT -i -H "Content-Type: application/json" -X POST -d '{ "action":"translate", "sourceLang":"en", "targetLang":"'$LANG'", "text": "Test" }' http://quest.ms.mff.cuni.cz:$PORT/khresmoi > /dev/null 2>&1 && echo 'OK' ) || echo 'NOT WORKING'
done | grep 'NOT WORKING' | mail -E -s 'MT problem' $1
